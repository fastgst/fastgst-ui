---
layout: base.njk
permalink: /hsn-sac-finder/
title: Find HSN Code & GST Rate – Free HSN/SAC Lookup Tool
description: Search HSN codes and find GST rates instantly. Free online tool to check HSN/SAC codes, view tax rates, and browse classification hierarchy for GST compliance.
canonical: /hsn-sac-finder/
preloadFonts: true
schemaData: |
  <script type="application/ld+json">
  {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "FastGST Free HSN/SAC Code Checker & Tax Rate Finder",
      "description": "Free online tool to search HSN/SAC codes, check GST tax rates, and view classification hierarchy. Powered by FastGST Tax Lookup REST API.",
      "url": "https://www.fastgst.in/hsn-sac-finder/",
      "applicationCategory": "BusinessApplication",
      "operatingSystem": "Any",
      "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "INR"
      },
      "featureList": [
          "Search HSN/SAC Codes",
          "Check GST Tax Rates",
          "View Compensation Cess",
          "Browse Classification Hierarchy"
      ]
  }
  </script>

  <script type="application/ld+json">
  {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
          {
              "@type": "ListItem",
              "position": 1,
              "name": "Home",
              "item": "https://www.fastgst.in/"
          },
          {
              "@type": "ListItem",
              "position": 2,
              "name": "HSN/SAC Finder",
              "item": "https://www.fastgst.in/hsn-sac-finder/"
          }
      ]
  }
  </script>
---

<!-- Hero Section -->
<main class="overflow-x-hidden">
    <section class="gradient-bg hero-pattern py-20 relative overflow-hidden">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">

            <!-- Hero Content -->
            <div class="text-center mb-16">
                <div id="hero-header">
                    <!-- Main Heading -->
                    <div class="mb-8 mt-8">
                        <h1 class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl xl:text-6xl font-extrabold text-gray-900 mb-6 leading-tight tracking-tight">
                            <span class="text-black">Free </span><span class="text-transparent bg-clip-text relative" style="background-image: linear-gradient(to right, rgb(71, 66, 239), rgb(55, 50, 200), rgb(71, 66, 239));">
                                GST Tax Rate Checker
                                <div class="absolute -bottom-2 left-0 right-0 h-1 rounded-full opacity-60" style="background: linear-gradient(to right, rgba(71, 66, 239, 0.6), rgb(71, 66, 239));"></div>
                            </span>
                        </h1>
                    </div>

                    <!-- API Promo Banner -->
                    <div class="mb-10 flex justify-center px-4">
                        <a href="https://www.consoledesk.in/marketplace/tax-lookup-api" target="_blank" class="relative z-20 group inline-flex flex-col sm:flex-row items-center gap-4 px-6 py-4 sm:py-3 rounded-2xl sm:rounded-full bg-white border-2 border-lime-100 shadow-xl hover:shadow-2xl hover:border-lime-300 transition-all duration-300 no-underline animate-border">
                            
                            <!-- Developer Icon Badge -->
                            <div class="flex items-center gap-3">
                                <div class="flex items-center justify-center w-10 h-10 rounded-full bg-lime-100 text-lime-700 group-hover:bg-lime-600 group-hover:text-white shadow-inner transition-all duration-500">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                                    </svg>
                                </div>
                                <div class="flex flex-col items-start text-left">
                                    <span class="text-[10px] font-bold text-lime-600 uppercase tracking-widest leading-none mb-1">Developer API</span>
                                    <p class="text-sm sm:text-base font-bold text-gray-900 leading-tight">
                                        Implement this search in your <span class="text-lime-700">App, Website or Software</span>
                                    </p>
                                </div>
                            </div>

                            <!-- Divider (Desktop only) -->
                            <div class="hidden sm:block h-8 w-px bg-gray-200 mx-2"></div>

                            <!-- CTA Section -->
                            <div class="flex items-center gap-2">
                                <span class="text-xs sm:text-sm font-bold text-gray-500 group-hover:text-lime-700 transition-colors">Get API Key & Integrate</span>
                                <div class="flex items-center justify-center w-6 h-6 rounded-full bg-lime-100 text-lime-700 group-hover:bg-lime-600 group-hover:text-white transition-all duration-300">
                                    <svg class="w-3.5 h-3.5 transform group-hover:translate-x-0.5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                                    </svg>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- Compact GST Search Interface -->
                <div class="max-w-6xl mx-auto mb-8">

                    <!-- Compact Search Card -->
                    <div class="gst-search-card bg-white/95 backdrop-blur-sm rounded-xl shadow-xl border border-gray-200/50 relative z-20">
                        <!-- Main Toggle: Search Goods / Search Services -->
                        <div id="main-toggle-bar" class="p-4 bg-gray-100 border-b border-gray-200/50">
                            <div class="flex p-1 bg-white rounded-xl border border-gray-200 shadow-inner gap-1 max-w-md mx-auto">
                                <button onclick="switchMainTab('goods')" id="main-tab-goods" class="flex-1 py-3 px-6 text-sm font-bold rounded-lg transition-all duration-200 shadow-sm bg-black text-white">
                                    <span class="flex items-center justify-center gap-2">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                                        </svg>
                                        Search Goods
                                    </span>
                                </button>
                                <button onclick="switchMainTab('services')" id="main-tab-services" class="flex-1 py-3 px-6 text-sm font-bold rounded-lg transition-all duration-200 text-gray-500 hover:bg-gray-50">
                                    <span class="flex items-center justify-center gap-2">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                        </svg>
                                        Search Services
                                    </span>
                                </button>
                            </div>
                        </div>

                        <!-- Search Interface Section -->
                        <div id="search-interface" class="p-6 bg-gradient-to-r from-blue-50/80 to-indigo-50/80 border-b border-gray-200/50">
                            
                            <!-- GOODS PANEL -->
                            <div id="goods-panel" class="space-y-6">
                                <!-- Search Goods By Keyword -->
                                <div class="relative">
                                    <!-- Section Label -->
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-blue-100 text-blue-600">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                            </svg>
                                        </div>
                                        <h3 class="text-sm font-bold text-gray-700 uppercase tracking-wider">Search Goods By Keyword</h3>
                                    </div>
                                    
                                    <!-- Keyword Search Input -->
                                    <div class="relative">
                                        <div class="absolute left-4 top-1/2 -translate-y-1/2 z-10 flex items-center pointer-events-none text-gray-400">
                                            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                            </svg>
                                        </div>
                                        <input
                                            type="text"
                                            id="hsn-keyword-input"
                                            placeholder="Search for goods like 'rice', 'mobile phone', 'cotton fabric'..."
                                            class="w-full pl-12 pr-4 py-4 text-sm md:text-lg border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-300 outline-none bg-white shadow-md"
                                        >
                                    </div>

                                    <!-- Keyword Search Results -->
                                    <div id="hsn-keyword-results" class="hidden relative z-50 w-full mt-4">
                                        <div class="pb-4">
                                            <div class="space-y-0">
                                                <!-- Search results will be populated here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Divider -->
                                <div class="relative">
                                    <div class="absolute inset-0 flex items-center" aria-hidden="true">
                                        <div class="w-full border-t border-gray-300"></div>
                                    </div>
                                    <div class="relative flex justify-center">
                                        <span class="bg-gradient-to-r from-blue-50/80 to-indigo-50/80 px-4 py-1 text-xs font-bold text-gray-400 uppercase tracking-wider">
                                            Or
                                        </span>
                                    </div>
                                </div>

                                <!-- Search By HSN Code -->
                                <div class="relative">
                                    <!-- Section Label -->
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-emerald-100 text-emerald-600">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14" />
                                            </svg>
                                        </div>
                                        <h3 class="text-sm font-bold text-gray-700 uppercase tracking-wider">Search By HSN Code</h3>
                                    </div>
                                    
                                    <!-- HSN Code Input -->
                                    <div class="relative">
                                        <div class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400">
                                            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14" />
                                            </svg>
                                        </div>
                                        <input
                                            type="text"
                                            id="hsn-input-field"
                                            maxlength="11"
                                            placeholder="Enter HSN Code (XX-XX-XX-XX)"
                                            class="w-full pl-12 pr-[160px] py-4 text-sm md:text-lg border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-300 outline-none bg-white shadow-md text-gray-800 font-medium"
                                        >
                                        <button id="hsn-search-btn" class="absolute right-1.5 top-1.5 bottom-1.5 px-4 bg-black text-white text-sm font-bold rounded-lg hover:bg-gray-800 active:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed shadow-sm uppercase tracking-wide" disabled>
                                            Lookup HSN
                                        </button>
                                    </div>
                                    <div id="hsn-helper-text" class="mt-2 text-xs font-medium text-left text-red-500">
                                        Please enter 8-digit tariff item HSN code
                                    </div>
                                </div>
                            </div>

                            <!-- SERVICES PANEL (Hidden by default) -->
                            <div id="services-panel" class="space-y-6 hidden">
                                <!-- Search Services By Keyword -->
                                <div class="relative">
                                    <!-- Section Label -->
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-purple-100 text-purple-600">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                            </svg>
                                        </div>
                                        <h3 class="text-sm font-bold text-gray-700 uppercase tracking-wider">Search Services By Keyword</h3>
                                    </div>
                                    
                                    <!-- Keyword Search Input -->
                                    <div class="relative">
                                        <div class="absolute left-4 top-1/2 -translate-y-1/2 z-10 flex items-center pointer-events-none text-gray-400">
                                            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                            </svg>
                                        </div>
                                        <input
                                            type="text"
                                            id="sac-keyword-input"
                                            placeholder="Search for services like 'consulting', 'transportation', 'hotel'..."
                                            class="w-full pl-12 pr-4 py-4 text-sm md:text-lg border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all duration-300 outline-none bg-white shadow-md"
                                        >
                                    </div>

                                    <!-- Keyword Search Results -->
                                    <div id="sac-keyword-results" class="hidden relative z-50 w-full mt-4">
                                        <div class="pb-4">
                                            <div class="space-y-0">
                                                <!-- Search results will be populated here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Divider -->
                                <div class="relative">
                                    <div class="absolute inset-0 flex items-center" aria-hidden="true">
                                        <div class="w-full border-t border-gray-300"></div>
                                    </div>
                                    <div class="relative flex justify-center">
                                        <span class="bg-gradient-to-r from-blue-50/80 to-indigo-50/80 px-4 py-1 text-xs font-bold text-gray-400 uppercase tracking-wider">
                                            Or
                                        </span>
                                    </div>
                                </div>

                                <!-- Search By SAC Code -->
                                <div class="relative">
                                    <!-- Section Label -->
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-orange-100 text-orange-600">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14" />
                                            </svg>
                                        </div>
                                        <h3 class="text-sm font-bold text-gray-700 uppercase tracking-wider">Search By SAC Code</h3>
                                    </div>
                                    
                                    <!-- SAC Code Input -->
                                    <div class="relative">
                                        <div class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400">
                                            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14" />
                                            </svg>
                                        </div>
                                        <input
                                            type="text"
                                            id="sac-input-field"
                                            maxlength="9"
                                            placeholder="Enter SAC Code (XXX-X-X-X)"
                                            class="w-full pl-12 pr-[160px] py-4 text-sm md:text-lg border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all duration-300 outline-none bg-white shadow-md text-gray-800 font-medium"
                                        >
                                        <button id="sac-search-btn" class="absolute right-1.5 top-1.5 bottom-1.5 px-4 bg-black text-white text-sm font-bold rounded-lg hover:bg-gray-800 active:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed shadow-sm uppercase tracking-wide" disabled>
                                            Lookup SAC
                                        </button>
                                    </div>
                                    <div id="sac-helper-text" class="mt-2 text-xs font-medium text-left text-red-500">
                                        Please enter 6-digit service SAC code
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Content Area -->
                        <div class="flex flex-col min-h-[500px] hidden" id="results-panel">
                            
                            <!-- Search Summary Header -->
                            <div class="px-6 py-4 bg-gray-50 border-b border-gray-200 flex justify-between items-center">
                                <div>
                                    <h2 class="text-lg font-bold text-gray-900" id="results-title">Search Results</h2>
                                    <p class="text-sm text-gray-500">To perform a new search, please refresh the page.</p>
                                </div>
                            </div>

                            <!-- Row 1 - Hierarchy Tree (Classification) -->
                            <div id="panel-classification" class="w-full p-6 transition-all duration-300 border-b border-gray-200">
                                <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                    </svg>
                                    Classification Hierarchy
                                </h3>
                                <div id="hierarchy-tree" class="space-y-3">
                                    <!-- Default state -->
                                    <div class="text-center py-8 text-gray-400">
                                        <svg class="w-12 h-12 mx-auto mb-3 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                        </svg>
                                        <p class="text-sm">Search to view hierarchy</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Row 2 - Tax Details (Tax Rates) -->
                            <div id="panel-tax" class="w-full p-6 transition-all duration-300">
                                <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                                    </svg>
                                    GST Tax Rates & Details
                                </h3>
                                <div id="tax-details" class="space-y-6">
                                    <!-- Default state -->
                                    <div class="text-center py-8 text-gray-400">
                                        <svg class="w-12 h-12 mx-auto mb-3 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                                        </svg>
                                        <p class="text-sm">Select code to view tax details</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>
                    </div>
                </div>

            </div>

        <!-- Floating elements -->
        <div id="hero-floating-elements">
            <div class="absolute top-20 left-10 w-20 h-20 rounded-full float-animation" style="background-color: rgba(71, 66, 239, 0.15);"></div>
            <div class="absolute bottom-20 right-10 w-32 h-32 rounded-full float-animation" style="background-color: rgba(71, 66, 239, 0.12); animation-delay: -2s;"></div>
            <div class="absolute top-40 right-20 w-16 h-16 rounded-full float-animation" style="background-color: rgba(71, 66, 239, 0.18); animation-delay: -1s;"></div>
            <div class="absolute bottom-40 left-20 w-24 h-24 rounded-full float-animation" style="background-color: rgba(71, 66, 239, 0.14); animation-delay: -3s;"></div>
        </div>
    </section>
</main>

<!-- GST Tax Lookup API Module -->
<script src="/_includes/rpak.js"></script>
<script src="/_includes/tax-lookup-api.js"></script>

<!-- Custom Styles for Playground -->
<style>
/* Google-like search dropdown animations */
#search-results {
    animation: dropdownFadeIn 0.15s ease-out;
}

.search-result-item {
    animation: resultSlideIn 0.2s ease-out forwards;
    opacity: 0;
    transform: translateY(4px);
}

.search-result-item:nth-child(1) { animation-delay: 0.05s; }
.search-result-item:nth-child(2) { animation-delay: 0.08s; }
.search-result-item:nth-child(3) { animation-delay: 0.11s; }
.search-result-item:nth-child(4) { animation-delay: 0.14s; }
.search-result-item:nth-child(5) { animation-delay: 0.17s; }
.search-result-item:nth-child(6) { animation-delay: 0.20s; }

/* Custom Scrollbar */
.custom-scrollbar::-webkit-scrollbar {
    width: 6px;
}

.custom-scrollbar::-webkit-scrollbar-track {
    background: transparent;
}

.custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: rgba(156, 163, 175, 0.5);
    border-radius: 20px;
    border: 2px solid transparent;
    background-clip: content-box;
}

.custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background-color: rgba(107, 114, 128, 0.8);
}

@keyframes dropdownFadeIn {
    from {
        opacity: 0;
        transform: translateY(-4px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes resultSlideIn {
    0% {
        opacity: 0;
        transform: translateY(-10px) scale(0.98);
    }
    100% {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

@keyframes borderPulse {
    0% {
        box-shadow: 0 0 0 0 rgba(132, 204, 22, 0.4);
    }
    70% {
        box-shadow: 0 0 0 6px rgba(132, 204, 22, 0);
    }
    100% {
        box-shadow: 0 0 0 0 rgba(132, 204, 22, 0);
    }
}

.animate-border {
    border: 2px solid #d9f99d; /* lime-200 */
    animation: borderPulse 2s infinite;
}

.animate-drop-in {
    animation: resultSlideIn 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; /* ease-out-expoish */
    opacity: 0; /* Start invisible */
}

/* Custom Scrollbar */
.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}


/* Compact tree structure styling */
.tree-node {
    position: relative;
    padding-left: 20px;
}

.tree-node::before {
    content: '';
    position: absolute;
    left: 6px;
    top: 50%;
    transform: translateY(-50%);
    width: 10px;
    height: 1.5px;
    background-color: #e5e7eb;
}

.tree-node::after {
    content: '';
    position: absolute;
    left: 6px;
    top: 0;
    bottom: 0;
    width: 1.5px;
    background-color: #e5e7eb;
}

.tree-node:last-child::after {
    height: 50%;
}

.tree-node .tree-content {
    padding: 8px 12px;
    background: #f9fafb;
    border-radius: 6px;
    border: 1.5px solid #e5e7eb;
    transition: all 0.3s ease;
    font-size: 0.875rem;
}

.tree-node.active .tree-content {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-color: #667eea;
    box-shadow: 0 3px 8px rgba(102, 126, 234, 0.25);
}

/* Compact tax detail cards */
.tax-card {
    background: white;
    border-radius: 8px;
    padding: 12px;
    border: 1.5px solid #e5e7eb;
    transition: all 0.3s ease;
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
    font-size: 0.875rem;
}

.tax-card:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
}

.tax-rate {
    font-size: 1.25rem;
    font-weight: bold;
    color: #059669;
}

/* Responsive adjustments for compact design */
@media (max-width: 1024px) {
    .gst-search-card .flex {
        flex-direction: column;
    }

    .gst-search-card .flex > div {
        border-right: none;
        border-bottom: 1.5px solid #e5e7eb;
    }

    .gst-search-card .flex > div:last-child {
        border-bottom: none;
    }
}
</style>

<!-- Daily Limit Reached Popup Modal -->
<div id="daily-limit-modal" class="fixed inset-0 z-[9999] hidden">
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeDailyLimitModal()"></div>
    
    <!-- Modal Content -->
    <div class="absolute inset-0 flex items-center justify-center p-4">
        <div class="relative bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 transform transition-all animate-drop-in">
            <!-- Close Button -->
            <button onclick="closeDailyLimitModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
            
            <!-- Icon -->
            <div class="flex justify-center mb-6">
                <div class="w-20 h-20 rounded-full bg-gradient-to-br from-orange-100 to-red-100 flex items-center justify-center">
                    <svg class="w-10 h-10 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                    </svg>
                </div>
            </div>
            
            <!-- Title -->
            <h3 class="text-2xl font-bold text-gray-900 text-center mb-3">Daily Limit Reached</h3>
            
            <!-- Description -->
            <p class="text-gray-600 text-center mb-6 leading-relaxed">
                You've used all <span class="font-bold text-orange-600">5 free searches</span> for today. 
                Get an API key to unlock higher quotas and integrate this search into your own applications.
            </p>
            
            <!-- Usage Counter Display -->
            <div class="bg-gray-50 rounded-xl p-4 mb-6 border border-gray-200">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-medium text-gray-600">Today's Usage</span>
                    <span id="modal-usage-count" class="text-sm font-bold text-red-600">5 / 5</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div class="bg-gradient-to-r from-orange-500 to-red-500 h-2 rounded-full" style="width: 100%"></div>
                </div>
                <p class="text-xs text-gray-500 mt-2 text-center">Resets at midnight</p>
            </div>
            
            <!-- CTA Button -->
            <a href="https://www.consoledesk.in/marketplace/tax-lookup-api" target="_blank" 
               class="block w-full py-4 px-6 bg-gradient-to-r from-lime-500 to-green-600 text-white font-bold text-center rounded-xl shadow-lg hover:shadow-xl hover:from-lime-600 hover:to-green-700 transition-all duration-300 no-underline">
                <span class="flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"></path>
                    </svg>
                    Get Your API Key
                </span>
            </a>
            
            <!-- Secondary Link -->
            <p class="text-center mt-4 text-sm text-gray-500">
                <a href="https://www.consoledesk.in/marketplace/tax-lookup-api" target="_blank" class="text-blue-600 hover:underline">
                    Learn more about API pricing →
                </a>
            </p>
        </div>
    </div>
</div>

<!-- JavaScript for Search Functionality -->
<script>
// ==========================================
// RATE LIMITER - Daily Search Limit (5/day)
// Obfuscated storage with decoys
// ==========================================
const DAILY_SEARCH_LIMIT = 5;

// Obfuscation utilities
const _0x = {
    // Simple XOR cipher with key
    _k: 'gst_f4st_2024_x7q',
    
    // Encode string
    enc: function(str) {
        let result = '';
        for (let i = 0; i < str.length; i++) {
            result += String.fromCharCode(str.charCodeAt(i) ^ this._k.charCodeAt(i % this._k.length));
        }
        return btoa(result).replace(/=/g, '_').replace(/\+/g, '-').replace(/\//g, '.');
    },
    
    // Decode string
    dec: function(str) {
        try {
            const b64 = str.replace(/_/g, '=').replace(/-/g, '+').replace(/\./g, '/');
            const decoded = atob(b64);
            let result = '';
            for (let i = 0; i < decoded.length; i++) {
                result += String.fromCharCode(decoded.charCodeAt(i) ^ this._k.charCodeAt(i % this._k.length));
            }
            return result;
        } catch(e) {
            return null;
        }
    },
    
    // Generate pseudo-random key based on seed
    genKey: function(seed) {
        let hash = 0;
        for (let i = 0; i < seed.length; i++) {
            const char = seed.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash;
        }
        return '_' + Math.abs(hash).toString(36) + '_cache_v2';
    }
};

// Dynamic storage key (looks like a cache key)
const _STORAGE_KEY = _0x.genKey('tax_lookup_session_metrics');

// Decoy key generators
const _decoyKeys = [
    () => '_' + Math.random().toString(36).substr(2, 8) + '_theme_pref',
    () => '_' + Math.random().toString(36).substr(2, 8) + '_ui_state',
    () => '_' + Math.random().toString(36).substr(2, 8) + '_session_id',
    () => '_' + Math.random().toString(36).substr(2, 8) + '_analytics',
    () => '_' + Math.random().toString(36).substr(2, 8) + '_cache_ts',
    () => '_' + Math.random().toString(36).substr(2, 8) + '_user_pref',
    () => '_' + Math.random().toString(36).substr(2, 8) + '_scroll_pos',
    () => '_' + Math.random().toString(36).substr(2, 8) + '_tab_state'
];

// Generate decoy data that looks realistic
function _genDecoyValue() {
    const templates = [
        () => ({ v: Math.floor(Math.random() * 100), t: Date.now() - Math.floor(Math.random() * 86400000) }),
        () => ({ enabled: Math.random() > 0.5, ts: Date.now() }),
        () => ({ id: Math.random().toString(36).substr(2, 12), exp: Date.now() + 86400000 }),
        () => ({ count: Math.floor(Math.random() * 50), last: new Date().toISOString().split('T')[0] }),
        () => ({ state: ['active', 'idle', 'pending'][Math.floor(Math.random() * 3)], updated: Date.now() }),
        () => ({ x: Math.floor(Math.random() * 1000), y: Math.floor(Math.random() * 500) }),
        () => ({ mode: ['light', 'dark', 'auto'][Math.floor(Math.random() * 3)], v: '2.1' }),
        () => ({ flags: Math.floor(Math.random() * 255), rev: Math.floor(Math.random() * 10) })
    ];
    const data = templates[Math.floor(Math.random() * templates.length)]();
    return _0x.enc(JSON.stringify(data));
}

// Populate decoys on first load
function _initDecoys() {
    // Only add decoys if we haven't already (check for a marker)
    const markerKey = _0x.genKey('decoy_init_marker');
    if (localStorage.getItem(markerKey)) return;
    
    // Add 5-8 decoy items
    const numDecoys = 5 + Math.floor(Math.random() * 4);
    for (let i = 0; i < numDecoys; i++) {
        const key = _decoyKeys[i % _decoyKeys.length]();
        localStorage.setItem(key, _genDecoyValue());
    }
    
    // Set marker (also obfuscated)
    localStorage.setItem(markerKey, _0x.enc(JSON.stringify({ init: Date.now() })));
}

// Refresh some decoys periodically to add noise
function _refreshDecoys() {
    // Randomly update 1-2 decoys
    const numUpdates = 1 + Math.floor(Math.random() * 2);
    for (let i = 0; i < numUpdates; i++) {
        const key = _decoyKeys[Math.floor(Math.random() * _decoyKeys.length)]();
        localStorage.setItem(key, _genDecoyValue());
    }
}

// Get today's date as encoded string
function _getEncodedDate() {
    const today = new Date();
    const dateStr = today.toISOString().split('T')[0];
    // Add some noise to the date encoding
    return _0x.enc(dateStr + '|' + (today.getDay() * 7));
}

// Decode date from storage
function _decodeDate(encoded) {
    const decoded = _0x.dec(encoded);
    if (!decoded) return null;
    return decoded.split('|')[0];
}

// Get current usage data from localStorage (obfuscated)
function getUsageData() {
    try {
        const stored = localStorage.getItem(_STORAGE_KEY);
        if (!stored) {
            return { date: new Date().toISOString().split('T')[0], count: 0 };
        }
        
        const decrypted = _0x.dec(stored);
        if (!decrypted) {
            return { date: new Date().toISOString().split('T')[0], count: 0 };
        }
        
        const data = JSON.parse(decrypted);
        const storedDate = _decodeDate(data.d);
        const today = new Date().toISOString().split('T')[0];
        
        // Reset if it's a new day
        if (storedDate !== today) {
            return { date: today, count: 0 };
        }
        
        // Decode the count (stored with offset)
        const actualCount = (data.c ^ 0x5A) - 42;
        return { date: today, count: Math.max(0, actualCount) };
    } catch (e) {
        return { date: new Date().toISOString().split('T')[0], count: 0 };
    }
}

// Save usage data to localStorage (obfuscated)
function saveUsageData(data) {
    try {
        // Encode count with offset and XOR
        const encodedCount = (data.count + 42) ^ 0x5A;
        
        const payload = {
            d: _getEncodedDate(),
            c: encodedCount,
            // Add noise fields
            _r: Math.random().toString(36).substr(2, 6),
            _t: Date.now() ^ 0xDEAD,
            _v: '2.1.0'
        };
        
        const encrypted = _0x.enc(JSON.stringify(payload));
        localStorage.setItem(_STORAGE_KEY, encrypted);
        
        // Occasionally refresh decoys to add noise
        if (Math.random() > 0.7) {
            _refreshDecoys();
        }
    } catch (e) {
        // Silent fail
    }
}

// Increment the search counter
function incrementSearchCount() {
    const usage = getUsageData();
    usage.count += 1;
    saveUsageData(usage);
    updateUsageDisplay();
    return usage.count;
}

// Check if daily limit is reached
function isDailyLimitReached() {
    const usage = getUsageData();
    return usage.count >= DAILY_SEARCH_LIMIT;
}

// Get remaining searches
function getRemainingSearches() {
    const usage = getUsageData();
    return Math.max(0, DAILY_SEARCH_LIMIT - usage.count);
}

// Show the daily limit modal
function showDailyLimitModal() {
    const modal = document.getElementById('daily-limit-modal');
    if (modal) {
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }
}

// Close the daily limit modal
function closeDailyLimitModal() {
    const modal = document.getElementById('daily-limit-modal');
    if (modal) {
        modal.classList.add('hidden');
        document.body.style.overflow = '';
    }
}

// Update the visible usage counter display
function updateUsageDisplay() {
    const usage = getUsageData();
    const usageCounter = document.getElementById('search-usage-counter');
    if (usageCounter) {
        usageCounter.textContent = `${usage.count} / ${DAILY_SEARCH_LIMIT}`;
        // Update color based on usage
        if (usage.count >= DAILY_SEARCH_LIMIT) {
            usageCounter.className = 'text-xs font-bold text-red-600';
        } else if (usage.count >= DAILY_SEARCH_LIMIT - 1) {
            usageCounter.className = 'text-xs font-bold text-orange-600';
        } else {
            usageCounter.className = 'text-xs font-bold text-green-600';
        }
    }
    
    // Update progress bar
    const progressBar = document.getElementById('search-usage-bar');
    if (progressBar) {
        const percentage = Math.min(100, (usage.count / DAILY_SEARCH_LIMIT) * 100);
        progressBar.style.width = `${percentage}%`;
        // Update color
        if (usage.count >= DAILY_SEARCH_LIMIT) {
            progressBar.className = 'h-full rounded-full transition-all duration-300 bg-red-500';
        } else if (usage.count >= DAILY_SEARCH_LIMIT - 1) {
            progressBar.className = 'h-full rounded-full transition-all duration-300 bg-orange-500';
        } else {
            progressBar.className = 'h-full rounded-full transition-all duration-300 bg-green-500';
        }
    }
}

// Check rate limit and show modal if exceeded - returns true if allowed, false if blocked
function checkRateLimit() {
    if (isDailyLimitReached()) {
        showDailyLimitModal();
        return false;
    }
    return true;
}

// Make modal functions globally available
window.showDailyLimitModal = showDailyLimitModal;
window.closeDailyLimitModal = closeDailyLimitModal;

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    _initDecoys();
    updateUsageDisplay();
});

// ==========================================
// END RATE LIMITER
// ==========================================

// Global state for current search results
let currentSearchResults = [];
let currentSelectedHSN = null;
let currentSearchType = 'hsn'; // Default to HSN (goods)

// Global search functions (will be initialized after DOM load)
let performHSNKeywordSearch;
let performSACKeywordSearch;

    // Search functionality
    document.addEventListener('DOMContentLoaded', function() {
        const hsnKeywordInput = document.getElementById('hsn-keyword-input');
        const sacKeywordInput = document.getElementById('sac-keyword-input');
        const hsnKeywordResults = document.getElementById('hsn-keyword-results');
        const sacKeywordResults = document.getElementById('sac-keyword-results');
        const hsnResultsContainer = hsnKeywordResults ? hsnKeywordResults.querySelector('.space-y-0') : null;
        const sacResultsContainer = sacKeywordResults ? sacKeywordResults.querySelector('.space-y-0') : null;

        let hsnSearchTimeout;
        let sacSearchTimeout;

    // Main Tab Switcher
    window.switchMainTab = function(tab) {
        const goodsTab = document.getElementById('main-tab-goods');
        const servicesTab = document.getElementById('main-tab-services');
        const goodsPanel = document.getElementById('goods-panel');
        const servicesPanel = document.getElementById('services-panel');

        if (tab === 'goods') {
            currentSearchType = 'hsn';
            // Active state for Goods tab
            goodsTab.className = 'flex-1 py-3 px-6 text-sm font-bold rounded-lg transition-all duration-200 shadow-sm bg-black text-white';
            servicesTab.className = 'flex-1 py-3 px-6 text-sm font-bold rounded-lg transition-all duration-200 text-gray-500 hover:bg-gray-50';
            // Show Goods panel, hide Services panel
            goodsPanel.classList.remove('hidden');
            servicesPanel.classList.add('hidden');
            // Clear service inputs
            if (sacKeywordInput) sacKeywordInput.value = '';
            if (sacKeywordResults) sacKeywordResults.classList.add('hidden');
        } else {
            currentSearchType = 'sac';
            // Active state for Services tab
            servicesTab.className = 'flex-1 py-3 px-6 text-sm font-bold rounded-lg transition-all duration-200 shadow-sm bg-black text-white';
            goodsTab.className = 'flex-1 py-3 px-6 text-sm font-bold rounded-lg transition-all duration-200 text-gray-500 hover:bg-gray-50';
            // Show Services panel, hide Goods panel
            servicesPanel.classList.remove('hidden');
            goodsPanel.classList.add('hidden');
            // Clear goods inputs
            if (hsnKeywordInput) hsnKeywordInput.value = '';
            if (hsnKeywordResults) hsnKeywordResults.classList.add('hidden');
        }

        // Clear code inputs
        clearCodeInputs();
        
        // Hide results panel
        const resultsPanel = document.getElementById('results-panel');
        if (resultsPanel) {
            resultsPanel.classList.add('hidden');
        }
    };

    // Helper function to clear code inputs only
    function clearCodeInputs() {
        // Clear HSN input
        const hsnInput = document.getElementById('hsn-input-field');
        if (hsnInput) {
            hsnInput.value = '';
            const hsnSearchBtn = document.getElementById('hsn-search-btn');
            if (hsnSearchBtn) hsnSearchBtn.disabled = true;
            const hsnHelperText = document.getElementById('hsn-helper-text');
            if (hsnHelperText) {
                hsnHelperText.textContent = 'Please enter 8-digit tariff item HSN code';
                hsnHelperText.className = 'mt-2 text-xs font-medium text-left text-red-500';
            }
        }
        
        // Clear SAC input
        const sacInput = document.getElementById('sac-input-field');
        if (sacInput) {
            sacInput.value = '';
            const sacSearchBtn = document.getElementById('sac-search-btn');
            if (sacSearchBtn) sacSearchBtn.disabled = true;
            const sacHelperText = document.getElementById('sac-helper-text');
            if (sacHelperText) {
                sacHelperText.textContent = 'Please enter 6-digit service SAC code';
                sacHelperText.className = 'mt-2 text-xs font-medium text-left text-red-500';
            }
        }
    }

    // Helper function to clear all inputs and reset UI state
    function clearAllInputs() {
        // Clear keyword inputs
        if (hsnKeywordInput) hsnKeywordInput.value = '';
        if (sacKeywordInput) sacKeywordInput.value = '';
        
        // Clear code inputs
        clearCodeInputs();
        
        // Hide search results
        if (hsnKeywordResults) hsnKeywordResults.classList.add('hidden');
        if (sacKeywordResults) sacKeywordResults.classList.add('hidden');
        
        // Hide results panel
        const resultsPanel = document.getElementById('results-panel');
        if (resultsPanel) {
            resultsPanel.classList.add('hidden');
        }
        
        // Clear current search results
        currentSearchResults = [];
        currentSelectedHSN = null;
    }

    // HSN Keyword Search handler
    // Note: This does NOT count towards rate limit - only clicking a result does
    performHSNKeywordSearch = async function(query) {
        if (!hsnResultsContainer) return;
        
        if (!query.trim()) {
            hsnKeywordResults.classList.add('hidden');
            currentSearchResults = [];
            return;
        }

        // Clear HSN code input when doing keyword search
        const hsnInput = document.getElementById('hsn-input-field');
        if (hsnInput) hsnInput.value = '';
        
        // Hide results panel
        const resultsPanel = document.getElementById('results-panel');
        if (resultsPanel) {
            resultsPanel.classList.add('hidden');
        }

        // Show loading state
        hsnResultsContainer.innerHTML = '<div class="px-4 py-3 text-gray-500 text-sm flex items-center gap-2"><div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"></div>Searching goods...</div>';
        hsnKeywordResults.classList.remove('hidden');

        try {
            const response = await TaxLookupAPI.searchByKeywords(query.trim());
            currentSearchResults = response.data || [];

            hsnResultsContainer.innerHTML = '';

            if (currentSearchResults.length > 0) {
                currentSearchResults.forEach((item, index) => {
                    const resultDiv = createSearchResultDiv(item, index, 'hsn');
                    if (resultDiv) {
                        hsnResultsContainer.appendChild(resultDiv);
                    }
                });
            } else {
                hsnResultsContainer.innerHTML = '<div class="px-4 py-3 text-gray-500 text-sm">No goods found matching your search</div>';
            }
        } catch (error) {
            hsnResultsContainer.innerHTML = '<div class="px-4 py-3 text-red-500 text-sm">Search failed. Please try again.</div>';
        }
    };

    // SAC Keyword Search handler
    // Note: This does NOT count towards rate limit - only clicking a result does
    performSACKeywordSearch = async function(query) {
        if (!sacResultsContainer) return;
        
        if (!query.trim()) {
            sacKeywordResults.classList.add('hidden');
            currentSearchResults = [];
            return;
        }

        // Clear SAC code input when doing keyword search
        const sacInput = document.getElementById('sac-input-field');
        if (sacInput) sacInput.value = '';
        
        // Hide results panel
        const resultsPanel = document.getElementById('results-panel');
        if (resultsPanel) {
            resultsPanel.classList.add('hidden');
        }

        // Show loading state
        sacResultsContainer.innerHTML = '<div class="px-4 py-3 text-gray-500 text-sm flex items-center gap-2"><div class="animate-spin rounded-full h-4 w-4 border-b-2 border-purple-500"></div>Searching services...</div>';
        sacKeywordResults.classList.remove('hidden');

        try {
            const response = await TaxLookupAPI.searchBySACKeywords(query.trim());
            currentSearchResults = response.data || [];

            sacResultsContainer.innerHTML = '';

            if (currentSearchResults.length > 0) {
                currentSearchResults.forEach((item, index) => {
                    const resultDiv = createSearchResultDiv(item, index, 'sac');
                    if (resultDiv) {
                        sacResultsContainer.appendChild(resultDiv);
                    }
                });
            } else {
                sacResultsContainer.innerHTML = '<div class="px-4 py-3 text-gray-500 text-sm">No services found matching your search</div>';
            }
        } catch (error) {
            sacResultsContainer.innerHTML = '<div class="px-4 py-3 text-red-500 text-sm">Search failed. Please try again.</div>';
        }
    };

    // HSN Keyword input event listeners
    if (hsnKeywordInput) {
        hsnKeywordInput.addEventListener('input', function() {
            clearTimeout(hsnSearchTimeout);
            hsnSearchTimeout = setTimeout(() => {
                performHSNKeywordSearch(this.value);
            }, 500);
        });

        hsnKeywordInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performHSNKeywordSearch(this.value);
            }
        });
    }

    // SAC Keyword input event listeners
    if (sacKeywordInput) {
        sacKeywordInput.addEventListener('input', function() {
            clearTimeout(sacSearchTimeout);
            sacSearchTimeout = setTimeout(() => {
                performSACKeywordSearch(this.value);
            }, 500);
        });

        sacKeywordInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSACKeywordSearch(this.value);
            }
        });
    }

    // Helper function to create search result div (Disconnected Cards)
    // type: 'hsn' or 'sac' determines which code input to populate on click
    function createSearchResultDiv(item, globalIndex = 0, type = 'hsn') {
        // If no matches, return null (don't show empty headers or "no items" message)
        if (!item.matches || item.matches.length === 0) {
            return null;
        }

        // Wrapper for the entire group (Parent + Matches)
        const groupWrapper = document.createElement('div');
        groupWrapper.className = 'mb-4 animate-drop-in';
        groupWrapper.style.animationDelay = `${globalIndex * 50}ms`;

        // 1. Parent/Hierarchy Description (Standalone Header)
        let hierarchyDesc = item.description || '';
        // Truncate at 50 chars
        if (hierarchyDesc.length > 50) {
            hierarchyDesc = hierarchyDesc.substring(0, 50) + '...';
        }
        
        const headerDiv = document.createElement('div');
        // Use different colors for HSN vs SAC
        const headerBg = type === 'sac' ? '#7c3aed' : '#2563eb'; // purple-600 for SAC, blue-600 for HSN
        const headerBorder = type === 'sac' ? 'border-purple-500' : 'border-blue-500';
        headerDiv.className = `mb-2 px-3 py-1 text-left rounded-full ${headerBorder} shadow-md inline-block max-w-full relative z-50 opacity-100`;
        headerDiv.style.backgroundColor = headerBg;
        headerDiv.innerHTML = `
            <p class="text-[10px] font-bold text-white uppercase tracking-wider leading-snug opacity-100 whitespace-nowrap truncate" style="color: #ffffff !important;">${hierarchyDesc}</p>
        `;
        groupWrapper.appendChild(headerDiv);

        // 2. Nested Matches (Individual Cards)
        item.matches.forEach((match, index) => {
            const matchCode = match.hsn_code || match.sac_code || '';
            const matchDesc = match.description || '';
            const matchScore = match.match_score || 0;
            const scorePercent = (matchScore * 100).toFixed(0);
            const scoreVal = parseInt(scorePercent);
            const isHighMatch = scoreVal > 95;
            
            // Define colors based on match score (Lime Green for >95%, Standard Green for others)
            const badgeBg = isHighMatch ? 'rgba(132, 204, 22, 0.2)' : 'rgba(34, 197, 94, 0.2)';
            const badgeBorder = isHighMatch ? 'rgba(132, 204, 22, 0.5)' : 'rgba(34, 197, 94, 0.3)';
            const dotColor = isHighMatch ? '#a3e635' : '#4ade80';
            const shadowColor = isHighMatch ? 'rgba(163, 230, 53, 0.6)' : 'rgba(74, 222, 128, 0.5)';

            // Different hover colors for HSN vs SAC
            const hoverBorderClass = type === 'sac' ? 'hover:border-purple-500' : 'hover:border-blue-500';

            const matchCard = document.createElement('div');
            matchCard.className = `mb-2 bg-gray-900 rounded-lg border border-gray-700 ${hoverBorderClass} cursor-pointer transition-all duration-150 group shadow-lg relative z-50 opacity-100 animate-drop-in`;
            matchCard.style.backgroundColor = '#111827';
            matchCard.style.animationDelay = `${index * 30}ms`;
            matchCard.dataset.code = matchCode;
            matchCard.dataset.type = type;
            
            // Code badge label
            const codeLabel = type === 'sac' ? 'SAC' : 'HSN';
            
            matchCard.innerHTML = `
                <div class="p-4 text-left">
                    <div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4">
                        <div class="flex items-center gap-2 flex-shrink-0 hidden sm:flex">
                            <!-- Match Score Badge -->
                            ${matchScore > 0 ? `
                            <div class="flex-shrink-0 flex items-center gap-1.5 px-2 py-1 rounded-md border" style="background-color: ${badgeBg}; border-color: ${badgeBorder};">
                                <div class="w-1.5 h-1.5 rounded-full" style="background-color: ${dotColor}; box-shadow: 0 0 8px ${shadowColor};"></div>
                                <span class="text-xs font-bold text-white tracking-wide" style="color: #ffffff !important;">${scorePercent}%</span>
                            </div>
                            ` : ''}

                            <!-- Code Badge -->
                            ${matchCode ? `
                            <div class="flex-shrink-0 flex items-center gap-1.5 px-2 py-1 rounded-md border" style="background-color: rgba(236, 72, 153, 0.2); border-color: rgba(236, 72, 153, 0.4);">
                                <div class="w-1.5 h-1.5 rounded-full" style="background-color: #ec4899; box-shadow: 0 0 8px rgba(236, 72, 153, 0.5);"></div>
                                <span class="text-xs font-bold text-white tracking-wide font-mono" style="color: #ffffff !important;">${matchCode}</span>
                            </div>
                            ` : ''}
                        </div>

                        <!-- Description -->
                        <p class="text-xs text-white font-medium leading-relaxed opacity-90 flex-1 line-clamp-1 sm:line-clamp-none" style="color: #ffffff !important;">
                            ${matchDesc}
                        </p>
                    </div>
                </div>
            `;
            
            // Add click event
            matchCard.onclick = (e) => {
                e.stopPropagation();

                const clickType = matchCard.dataset.type;

                if (clickType === 'sac') {
                    // Hide SAC keyword results
                    const sacKeywordResults = document.getElementById('sac-keyword-results');
                    if (sacKeywordResults) sacKeywordResults.classList.add('hidden');

                    // Copy SAC code to SAC input and click SAC search button
                    const sacInput = document.getElementById('sac-input-field');
                    const sacSearchBtn = document.getElementById('sac-search-btn');
                    const sacKeywordInput = document.getElementById('sac-keyword-input');

                    if (sacInput) {
                        sacInput.value = matchCode.replace(/\D/g, '');
                        sacInput.dispatchEvent(new Event('input'));
                    }

                    if (sacKeywordInput) sacKeywordInput.value = '';

                    if (sacSearchBtn) sacSearchBtn.click();
                } else {
                    // Hide HSN keyword results
                    const hsnKeywordResults = document.getElementById('hsn-keyword-results');
                    if (hsnKeywordResults) hsnKeywordResults.classList.add('hidden');

                    // Copy HSN code to HSN input and click HSN search button
                    const hsnInput = document.getElementById('hsn-input-field');
                    const hsnSearchBtn = document.getElementById('hsn-search-btn');
                    const hsnKeywordInput = document.getElementById('hsn-keyword-input');

                    if (hsnInput) {
                        hsnInput.value = matchCode.replace(/\D/g, '');
                        hsnInput.dispatchEvent(new Event('input'));
                    }

                    if (hsnKeywordInput) hsnKeywordInput.value = '';

                    if (hsnSearchBtn) hsnSearchBtn.click();
                }
            };
            
            groupWrapper.appendChild(matchCard);
        });

        return groupWrapper;
    }

    // Make search functions globally available for debugging
    window.performHSNKeywordSearch = performHSNKeywordSearch;
    window.performSACKeywordSearch = performSACKeywordSearch;

    // Helper to restart animations in a container
    window.restartAnimations = function(container) {
        if (!container) return;
        const animatedElements = container.querySelectorAll('.animate-drop-in');
        animatedElements.forEach(el => {
            // Remove animation class
            el.classList.remove('animate-drop-in');
            el.style.animation = 'none';
            
            // Force reflow (reading offsetHeight triggers reflow)
            void el.offsetHeight;
            
            // Re-add animation class/style
            el.style.animation = '';
            el.classList.add('animate-drop-in');
        });
        
        // Re-trigger bar widths if tax panel
        if (container.id === 'panel-tax') {
             setTimeout(() => {
                const barIgst = document.getElementById('bar-igst');
                const barCgst = document.getElementById('bar-cgst');
                const barSgst = document.getElementById('bar-sgst');
                // Reset to 0 first
                if (barIgst) { const w = barIgst.dataset.width || '0%'; barIgst.style.width = '0%'; setTimeout(() => barIgst.style.width = w, 50); }
                if (barCgst) { const w = barCgst.dataset.width || '0%'; barCgst.style.width = '0%'; setTimeout(() => barCgst.style.width = w, 50); }
                if (barSgst) { const w = barSgst.dataset.width || '0%'; barSgst.style.width = '0%'; setTimeout(() => barSgst.style.width = w, 50); }
            }, 50);
        }
    };

    // Tab Switching Logic (Deprecated but kept for safety/animations)
    window.switchTab = function(tabName) {
        // Now just a wrapper for restartAnimations if needed
        const classPanel = document.getElementById('panel-classification');
        const taxPanel = document.getElementById('panel-tax');
        if (tabName === 'classification' && classPanel) restartAnimations(classPanel);
        if (tabName === 'tax' && taxPanel) restartAnimations(taxPanel);
    };


    // Helper to send notification
    function sendNotification(key, operation, description = '') {
        let messageText = '';
        
        if (operation === 'search') {
            // For search, we want to show the clicked item name (description) if available, otherwise the code
            messageText = description ? `Clicked: ${description} (${key})` : `Searched Code: ${key}`;
        } else if (operation === 'lookup') {
            messageText = `HSN Lookup: ${key}`;
        } else {
            messageText = `Action: ${key}`;
        }

        fetch('https://api.consoledesk.in/global/notify', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                title: "🔍 PlayGround",
                text: messageText
            })
        }).catch(err => console.error("Notify error:", err));
    }

    // Select HSN code and display details
    async function selectHSNCode(hsnCode, description = '') {
        // Check rate limit before proceeding
        if (!checkRateLimit()) {
            return;
        }

        // Increment search counter
        incrementSearchCount();

        // Send notification (Search operation)
        const opType = description ? 'search' : 'lookup';
        sendNotification(hsnCode, opType, description);

        try {
            // Hide everything to focus on results
            const heroHeader = document.getElementById('hero-header');
            const mainToggleBar = document.getElementById('main-toggle-bar');
            const searchInterface = document.getElementById('search-interface');
            const floatingElements = document.getElementById('hero-floating-elements');
            
            if (heroHeader) heroHeader.classList.add('hidden');
            if (mainToggleBar) mainToggleBar.classList.add('hidden');
            if (searchInterface) searchInterface.classList.add('hidden');
            if (floatingElements) floatingElements.classList.add('hidden');

            // Show the results panel
            const resultsPanel = document.getElementById('results-panel');
            if (resultsPanel) {
                resultsPanel.classList.remove('hidden');
                resultsPanel.style.display = 'flex';
            }

            const hsnKeywordInput = document.getElementById('hsn-keyword-input');
            const hsnKeywordResults = document.getElementById('hsn-keyword-results');

            // Clear the keyword search input
            if(hsnKeywordInput) hsnKeywordInput.value = '';
            if(hsnKeywordResults) hsnKeywordResults.classList.add('hidden');
            
            // Update Title
            const resultsTitle = document.getElementById('results-title');
            if (resultsTitle) {
                resultsTitle.textContent = `Search Results for HSN: ${hsnCode}`;
            }

            // Show loading states
            showLoadingState();

            // Get complete HSN information using the combined API call
            const completeInfo = await TaxLookupAPI.getCompleteHSNInfo(hsnCode);

            // Update UI with real data
            // Extract the hierarchy object from the data
            const hierarchyData = { hierarchy: completeInfo.hierarchy.hierarchy };

            updateHierarchyTree(hierarchyData);
            updateTaxDetails(completeInfo.taxInfo);

            // Restart animations for both panels
            const classPanel = document.getElementById('panel-classification');
            const taxPanel = document.getElementById('panel-tax');
            if (classPanel) restartAnimations(classPanel);
            if (taxPanel) restartAnimations(taxPanel);

        } catch (error) {
            showErrorState('Invalid Search. Please try again.');
            
            // Ensure panel is visible even on error to show error message
            const resultsPanel = document.getElementById('results-panel');
            if (resultsPanel) {
                resultsPanel.classList.remove('hidden');
                resultsPanel.style.display = 'flex';
            }
        }
    }

    // Select SAC code and display details
    async function selectSACCode(sacCode, description = '') {
        // Check rate limit before proceeding
        if (!checkRateLimit()) {
            return;
        }

        // Increment search counter
        incrementSearchCount();

        // Send notification (Search operation)
        const opType = description ? 'search' : 'lookup';
        sendNotification(sacCode, opType, description);

        try {
            // Hide everything to focus on results
            const heroHeader = document.getElementById('hero-header');
            const mainToggleBar = document.getElementById('main-toggle-bar');
            const searchInterface = document.getElementById('search-interface');
            const floatingElements = document.getElementById('hero-floating-elements');
            
            if (heroHeader) heroHeader.classList.add('hidden');
            if (mainToggleBar) mainToggleBar.classList.add('hidden');
            if (searchInterface) searchInterface.classList.add('hidden');
            if (floatingElements) floatingElements.classList.add('hidden');

            // Show the results panel
            const resultsPanel = document.getElementById('results-panel');
            if (resultsPanel) {
                resultsPanel.classList.remove('hidden');
                resultsPanel.style.display = 'flex';
            }

            const sacKeywordInput = document.getElementById('sac-keyword-input');
            const sacKeywordResults = document.getElementById('sac-keyword-results');

            // Clear the keyword search input
            if(sacKeywordInput) sacKeywordInput.value = '';
            if(sacKeywordResults) sacKeywordResults.classList.add('hidden');
            
            // Update Title
            const resultsTitle = document.getElementById('results-title');
            if (resultsTitle) {
                resultsTitle.textContent = `Search Results for SAC: ${sacCode}`;
            }

            // Show loading states
            showLoadingState();

            // Get complete SAC information using the combined API call
            const completeInfo = await TaxLookupAPI.getCompleteSACInfo(sacCode);

            // Update UI with real data
            // For SAC data, the hierarchy is nested inside the data object
            const hierarchyData = { hierarchy: completeInfo.hierarchy.hierarchy };

            updateHierarchyTree(hierarchyData);
            updateTaxDetails(completeInfo.taxInfo);

            // Restart animations for both panels
            const classPanel = document.getElementById('panel-classification');
            const taxPanel = document.getElementById('panel-tax');
            if (classPanel) restartAnimations(classPanel);
            if (taxPanel) restartAnimations(taxPanel);

        } catch (error) {
            showErrorState('Invalid Search. Please try again.');

            // Ensure panel is visible even on error to show error message
            const resultsPanel = document.getElementById('results-panel');
            if (resultsPanel) {
                resultsPanel.classList.remove('hidden');
                resultsPanel.style.display = 'flex';
            }
        }
    }

    // Show loading state in both panels
    function showLoadingState() {
        const hierarchyTree = document.getElementById('hierarchy-tree');
        const taxDetails = document.getElementById('tax-details');

        hierarchyTree.innerHTML = '<div class="text-center py-8 text-gray-500"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-2"></div>Loading hierarchy...</div>';
        taxDetails.innerHTML = '<div class="text-center py-8 text-gray-500"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-2"></div>Loading tax details...</div>';
    }

    // Show error state
    function showErrorState(message) {
        const hierarchyTree = document.getElementById('hierarchy-tree');
        const taxDetails = document.getElementById('tax-details');

        const errorHTML = `<div class="text-center py-8 text-red-500"><svg class="w-12 h-12 mx-auto mb-3 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><p class="text-sm">${message}</p></div>`;

        hierarchyTree.innerHTML = errorHTML;
        taxDetails.innerHTML = errorHTML;
    }

    // Update hierarchy tree display (Dark Tree View)
    function updateHierarchyTree(hierarchyData) {
        const treeContainer = document.getElementById('hierarchy-tree');
        const hierarchy = hierarchyData.hierarchy;

        // Mobile optimization for indentation
        const isMobile = window.innerWidth < 768;
        const indentMultiplier = isMobile ? 12 : 24;

        // Detect if this is SAC or HSN data based on available keys
        const isSAC = hierarchy.group || hierarchy.sub_group;
        let levels;

        if (isSAC) {
            // SAC hierarchy levels
            levels = [
                { key: 'section', label: 'Section', color: '#60a5fa' }, // blue-400
                { key: 'heading', label: 'Heading', color: '#c084fc' }, // purple-400
                { key: 'group', label: 'Group', color: '#4ade80' }, // green-400
                { key: 'sub_group', label: 'Service Code', color: '#f472b6', active: true } // pink-400
            ];
        } else {
            // HSN hierarchy levels
            levels = [
                { key: 'section', label: 'Section', color: '#60a5fa' }, // blue-400
                { key: 'chapter', label: 'Chapter', color: '#4ade80' }, // green-400
                { key: 'heading', label: 'Heading', color: '#c084fc' }, // purple-400
                { key: 'sub_heading', label: 'Sub-heading', color: '#facc15' }, // yellow-400
                { key: 'tariff_item', label: 'Tariff Item', color: '#f472b6', active: true } // pink-400
            ];
        }

        let treeHTML = '<div class="relative pl-2 sm:pl-4 text-left">'; // Enforce text-left
        
        levels.forEach((level, index) => {
            const data = hierarchy[level.key];
            if (!data) return;

            const isLast = index === levels.length - 1;
            const indent = index * indentMultiplier; // Responsive indentation
            
            treeHTML += `
                <div class="relative mb-2 sm:mb-3 animate-drop-in" style="margin-left: ${indent}px; animation-delay: ${index * 100}ms">
                    <!-- Connector Lines (L shape) -->
                    ${index > 0 ? `
                        <!-- Vertical Line (Up to parent) -->
                        <div class="absolute" style="
                            left: -14px; 
                            top: -20px; 
                            bottom: 50%; 
                            width: 2px; 
                            background-color: #6b7280; 
                            z-index: 10;
                        "></div>
                        <!-- Horizontal Line (To current item) -->
                        <div class="absolute" style="
                            left: -14px; 
                            top: 50%; 
                            width: 14px; 
                            height: 2px; 
                            background-color: #6b7280; 
                            z-index: 10;
                        "></div>
                    ` : ''}

                    <!-- Node Card -->
                    <div class="flex flex-col sm:flex-row sm:items-start gap-2 sm:gap-4 p-3 sm:p-4 rounded-xl border transition-colors duration-200 relative z-20" 
                         style="background-color: ${level.active ? '#1f2937' : '#111827'}; border-color: ${level.active ? '#3b82f6' : '#374151'}; box-shadow: ${level.active ? '0 10px 15px -3px rgba(59, 130, 246, 0.1)' : 'none'};">
                        
                        <!-- Desktop Icon (Hidden on Mobile) -->
                        <div class="hidden sm:block flex-shrink-0 mt-1" style="color: ${level.color}">
                            ${level.active ? 
                                `<svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>` : 
                                `<svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path></svg>`
                            }
                        </div>
                        
                        <!-- Content Body -->
                        <div class="flex-1 min-w-0 text-left w-full">
                            
                            <!-- Mobile Header Row: Icon + Label + Code (One Line!) -->
                            <div class="flex !flex-row sm:hidden items-center gap-2 mb-1 w-full">
                                <!-- Mobile Icon -->
                                <div class="flex-shrink-0" style="color: ${level.color}">
                                    ${level.active ? 
                                        `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>` : 
                                        `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path></svg>`
                                    }
                                </div>
                                <!-- Label -->
                                <span class="inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-bold uppercase tracking-wide border flex-shrink-0" 
                                      style="background-color: ${level.color}33; color: ${level.color}; border-color: ${level.color}66;">
                                    ${level.label}
                                </span>
                                <!-- Code -->
                                <span class="text-base font-mono font-bold truncate" style="color: ${level.color};">${data.code}</span>
                            </div>

                            <!-- Desktop Header (Label + Code) -->
                            <div class="hidden sm:flex items-center gap-3 mb-2">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide border" 
                                      style="background-color: ${level.color}33; color: ${level.color}; border-color: ${level.color}66;">
                                    ${level.label}
                                </span>
                                <span class="text-lg font-mono font-bold" style="color: ${level.color};">${data.code}</span>
                            </div>
                            
                            <!-- Description -->
                            <p class="text-xs sm:text-sm text-white leading-relaxed font-medium opacity-100" style="color: #ffffff !important; font-size: ${isMobile ? '0.85rem' : '0.95rem'};">${data.description}</p>
                        </div>
                    </div>
                </div>
            `;
        });

        treeHTML += '</div>';

        treeContainer.innerHTML = treeHTML;
    }

    // Update tax details display (Dark Theme Redesign)
    function updateTaxDetails(taxData) {
        const detailsContainer = document.getElementById('tax-details');

        // Parse rates
        const igst = parseFloat(taxData.gst_breakdown.igst || 0);
        const cgst = parseFloat(taxData.gst_breakdown.cgst || 0);
        const sgst = parseFloat(taxData.gst_breakdown.sgst || 0);
        const totalTax = igst; // Assumption: IGST is total

        // Calculate relative widths based on the sum of all three components for ratio visualization
        const sumRates = igst + cgst + sgst;
        const widthIgst = sumRates > 0 ? (igst / sumRates) * 100 : 0;
        const widthCgst = sumRates > 0 ? (cgst / sumRates) * 100 : 0;
        const widthSgst = sumRates > 0 ? (sgst / sumRates) * 100 : 0;

        // Handle missing fields for SAC codes (cess and schedule might not exist)
        const cessBreakdown = taxData.cess_breakdown || 'Not Applicable';
        const cessDetail = taxData.cess_detail || 'Not Applicable';
        const cessDisplay = cessBreakdown.toLowerCase().includes('no') || cessBreakdown === 'Not Applicable' ? 'Nil' : TaxLookupAPI.formatCurrency(cessDetail);
        
        detailsContainer.innerHTML = `
            <!-- Main Split Layout: GST (Left) | Cess (Right) -->
            <div class="flex flex-col lg:flex-row gap-8 mb-8">
                
                <!-- 1. GST Breakdown Card (Dark) -->
                <div class="flex-1 bg-gray-900 rounded-3xl border border-gray-700 p-8 shadow-2xl animate-drop-in relative overflow-hidden group hover:shadow-blue-900/20 transition-shadow duration-300">
                    <!-- Background Glow -->
                    <div class="absolute top-0 right-0 w-64 h-64 bg-green-600/10 rounded-full blur-3xl -mr-16 -mt-16"></div>
                    
                    <div class="relative z-10">
                        <div class="flex flex-col items-start mb-6">
                            <h3 class="text-xl font-bold text-white tracking-tight mb-4">GST Breakdown</h3>
                            
                            <!-- Total Tax Display (Main Top Pink) -->
                            <div class="flex items-baseline gap-3">
                                <span class="text-7xl font-black text-pink-300 tracking-tighter drop-shadow-2xl" style="text-shadow: 0 0 30px rgba(249, 168, 212, 0.4);">${totalTax}%</span>
                                <span class="text-sm font-bold uppercase tracking-wider" style="color: #ffffff !important;">Total Tax</span>
                            </div>
                        </div>

                        <!-- Animated Multi-Color Bar -->
                        <div class="mb-6">
                            <div class="flex justify-between text-xs mb-2 font-bold uppercase tracking-wider" style="color: #ffffff !important;">
                                <span>Tax Composition</span>
                                <span class="opacity-90">Ratio Split</span>
                            </div>
                            <!-- The Bar Container (Polished) -->
                            <div class="h-6 w-full bg-gray-800 rounded-full overflow-hidden flex !flex-row shadow-[inset_0_2px_4px_rgba(0,0,0,0.3)] border border-gray-700 relative">
                                <!-- IGST Segment (Green) -->
                                <div class="h-full relative group transition-all duration-1000 cubic-bezier(0.4, 0, 0.2, 1)" style="width: 0%; background: linear-gradient(to bottom, #4ade80, #22c55e); box-shadow: 0 0 15px rgba(34,197,94,0.3);" id="bar-igst">
                                </div>
                                <!-- CGST Segment (Red) -->
                                <div class="h-full relative group transition-all duration-1000 cubic-bezier(0.4, 0, 0.2, 1) delay-100" style="width: 0%; background: linear-gradient(to bottom, #f87171, #ef4444); box-shadow: 0 0 15px rgba(239,68,68,0.3);" id="bar-cgst">
                                </div>
                                <!-- SGST Segment (Yellow) -->
                                <div class="h-full relative group transition-all duration-1000 cubic-bezier(0.4, 0, 0.2, 1) delay-200" style="width: 0%; background: linear-gradient(to bottom, #facc15, #eab308); box-shadow: 0 0 15px rgba(234,179,8,0.3);" id="bar-sgst">
                                </div>
                            </div>
                        </div>

                        <!-- Legend/Details Inline Row -->
                        <div class="flex !flex-row items-center justify-between w-full text-xs sm:text-sm">
                            <div class="flex items-center gap-1.5 sm:gap-2 whitespace-nowrap">
                                <div class="w-2.5 h-2.5 sm:w-3 sm:h-3 rounded-full bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.6)]"></div>
                                <span class="font-bold" style="color: #ffffff !important;">IGST</span>
                                <span class="font-bold text-white ml-1">${igst}%</span>
                            </div>
                            <div class="flex items-center gap-1.5 sm:gap-2 whitespace-nowrap">
                                <div class="w-2.5 h-2.5 sm:w-3 sm:h-3 rounded-full bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.6)]"></div>
                                <span class="font-bold" style="color: #ffffff !important;">CGST</span>
                                <span class="font-bold text-white ml-1">${cgst}%</span>
                            </div>
                            <div class="flex items-center gap-1.5 sm:gap-2 whitespace-nowrap">
                                <div class="w-2.5 h-2.5 sm:w-3 sm:h-3 rounded-full bg-yellow-500 shadow-[0_0_8px_rgba(234,179,8,0.6)]"></div>
                                <span class="font-bold" style="color: #ffffff !important;">SGST</span>
                                <span class="font-bold text-white ml-1">${sgst}%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 2. Cess Details Card (Dark - Compact) -->
                <div class="flex-1 bg-gray-900 rounded-3xl border border-gray-700 p-8 shadow-2xl animate-drop-in relative overflow-hidden group hover:shadow-orange-900/20 transition-shadow duration-300" style="animation-delay: 100ms">
                    <!-- Background Glow -->
                    <div class="absolute top-0 left-0 w-64 h-64 bg-orange-600/10 rounded-full blur-3xl -ml-16 -mt-16"></div>

                    <div class="relative z-10 h-full flex flex-col">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold text-white tracking-tight">Compensation Cess</h3>
                             <div class="flex flex-col items-end">
                                <span class="text-xs font-bold uppercase tracking-wider bg-orange-500/10 px-2 py-1 rounded border border-orange-500/20" style="color: #ffffff !important;">Additional</span>
                            </div>
                        </div>
                        
                        <div class="flex-1 flex flex-col items-center justify-center text-center">
                            <div class="text-5xl font-extrabold mb-3 tracking-tighter drop-shadow-lg" style="color: #ffffff !important;">${cessDisplay}</div>
                            <div class="px-5 py-2.5 bg-gray-800/80 rounded-xl border border-gray-700 inline-block backdrop-blur-sm">
                                <p class="text-sm font-medium" style="color: #ffffff !important;">${cessBreakdown}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 3. Regulatory Meta Grid (Polished) -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 animate-drop-in" style="animation-delay: 200ms">
                <!-- Status -->
                <div class="bg-gray-800 p-4 rounded-xl border border-gray-700 shadow-lg flex flex-col items-center justify-center relative overflow-hidden group hover:border-gray-600 transition-all">
                    <div class="absolute inset-0 bg-gradient-to-br ${taxData.is_exempted ? 'from-red-500/10 to-transparent' : 'from-emerald-500/10 to-transparent'} opacity-50"></div>
                    <div class="text-[10px] font-bold uppercase tracking-widest mb-2 z-10" style="color: #ffffff !important;">Exemption Status</div>
                    <div class="px-4 py-1.5 rounded-full border ${taxData.is_exempted ? 'bg-red-500/20 border-red-500/40 text-red-200' : 'bg-emerald-500/20 border-emerald-500/40 text-emerald-200'} z-10 shadow-sm backdrop-blur-sm">
                        <span class="text-sm font-bold tracking-wide">${taxData.exemption_status}</span>
                    </div>
                </div>

                <!-- Schedule -->
                <div class="bg-gray-800 p-4 rounded-xl border border-gray-700 shadow-lg flex flex-col items-center justify-center relative overflow-hidden group hover:border-gray-600 transition-all">
                    <div class="absolute inset-0 bg-gradient-to-br from-purple-500/10 to-transparent opacity-50"></div>
                    <div class="text-[10px] font-bold uppercase tracking-widest mb-2 z-10" style="color: #ffffff !important;">GST Schedule</div>
                    <div class="px-4 py-1.5 rounded-full border bg-purple-500/20 border-purple-500/40 text-purple-200 z-10 shadow-sm backdrop-blur-sm">
                        <span class="text-sm font-bold tracking-wide">${taxData.schedule || 'Not Applicable'}</span>
                    </div>
                </div>

                <!-- Last Updated -->
                <div class="bg-gray-800 p-4 rounded-xl border border-gray-700 shadow-lg flex flex-col items-center justify-center relative overflow-hidden group hover:border-gray-600 transition-all">
                    <div class="absolute inset-0 bg-gradient-to-br from-blue-500/10 to-transparent opacity-50"></div>
                    <div class="text-[10px] font-bold uppercase tracking-widest mb-2 z-10" style="color: #ffffff !important;">Last Updated</div>
                    <div class="flex items-center gap-2 px-4 py-1.5 rounded-full border bg-blue-500/20 border-blue-500/40 text-blue-200 z-10 shadow-sm backdrop-blur-sm">
                        <svg class="w-3 h-3 opacity-70" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                        <span class="text-sm font-bold font-mono tracking-wide">${taxData.last_updated}</span>
                    </div>
                </div>

                <!-- Version -->
                <div class="bg-gray-800 p-4 rounded-xl border border-gray-700 shadow-lg flex flex-col items-center justify-center relative overflow-hidden group hover:border-gray-600 transition-all">
                    <div class="absolute inset-0 bg-gradient-to-br from-pink-500/10 to-transparent opacity-50"></div>
                    <div class="text-[10px] font-bold uppercase tracking-widest mb-2 z-10" style="color: #ffffff !important;">Data Version</div>
                    <div class="px-4 py-1.5 rounded-full border bg-pink-500/20 border-pink-500/40 text-pink-200 z-10 shadow-sm backdrop-blur-sm">
                        <span class="text-sm font-bold tracking-wide">${taxData.broad_categeory}</span>
                    </div>
                </div>
            </div>

            <!-- Source Notification (Card Style) -->
            <div class="mt-6 animate-drop-in" style="animation-delay: 300ms">
                 <div class="bg-gray-900 rounded-xl border border-gray-700 p-0 overflow-hidden shadow-lg flex flex-col md:flex-row">
                    <!-- Icon/Label Section -->
                    <div class="bg-gray-800 p-4 md:w-48 flex flex-col justify-center items-center md:items-start md:border-r border-gray-700 border-b md:border-b-0">
                        <div class="flex items-center gap-2 mb-1 text-blue-400">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                            <span class="text-xs font-bold uppercase tracking-wider">Source</span>
                        </div>
                        <span class="text-[10px] font-medium" style="color: #ffffff !important;">Official Notifications</span>
                    </div>
                    
                    <!-- Content Section -->
                    <div class="p-4 flex-1 bg-gray-900/50 flex items-center">
                        <p class="text-xs font-mono leading-relaxed opacity-90" style="color: #ffffff !important;">
                            ${taxData.source}
                        </p>
                    </div>
                </div>
            </div>
        `;

        // Trigger Animations after render
        // We set widths to actual values after a slight delay to trigger CSS transition
        setTimeout(() => {
            const barIgst = document.getElementById('bar-igst');
            const barCgst = document.getElementById('bar-cgst');
            const barSgst = document.getElementById('bar-sgst');
            
            // Visual split logic: 
            // If total is 18:
            // Visual Bar: [ 50% IGST (Blue) ][ 25% CGST (Green) ][ 25% SGST (Purple) ] to represent the components
            // This is a purely visual representation of the available components
            if (barIgst) {
                barIgst.style.width = `${widthIgst}%`;
                barIgst.dataset.width = `${widthIgst}%`;
            }
            if (barCgst) {
                barCgst.style.width = `${widthCgst}%`;
                barCgst.dataset.width = `${widthCgst}%`;
            }
            if (barSgst) {
                barSgst.style.width = `${widthSgst}%`;
                barSgst.dataset.width = `${widthSgst}%`;
            }
        }, 100);
    }

    // HSN Code Input Logic
    const hsnInput = document.getElementById('hsn-input-field');
    const hsnSearchBtn = document.getElementById('hsn-search-btn');

    if (hsnInput && hsnSearchBtn) {
        // Initialize helper text
        const helperText = document.getElementById('hsn-helper-text');
        if (helperText) {
            helperText.textContent = 'Please enter 8-digit tariff item HSN code';
            helperText.className = 'mt-2 text-xs font-medium text-left text-red-500';
        }

        // Handle Input
        hsnInput.addEventListener('input', (e) => {
            let val = e.target.value;

            // Remove any existing hyphens and non-digits
            val = val.replace(/[^\d]/g, '');

            // Limit to exactly 8 digits
            val = val.slice(0, 8);

            // Apply HSN format: XX-XX-XX-XX (8 digits: 2-2-2-2)
            if (val.length > 6) {
                val = val.slice(0, 2) + '-' + val.slice(2, 4) + '-' + val.slice(4, 6) + '-' + val.slice(6);
            } else if (val.length > 4) {
                val = val.slice(0, 2) + '-' + val.slice(2, 4) + '-' + val.slice(4);
            } else if (val.length > 2) {
                val = val.slice(0, 2) + '-' + val.slice(2);
            }

            e.target.value = val;

            // Update Search Button State and Helper Text
            const digitCount = val.replace(/-/g, '').length;
            const hsnHelperText = document.getElementById('hsn-helper-text');

            if (hsnHelperText) {
                if (digitCount === 8) {
                    hsnHelperText.textContent = 'Valid HSN Tariff Item';
                    hsnHelperText.className = 'mt-2 text-xs font-medium text-left text-green-600';
                    hsnSearchBtn.disabled = false;
                } else {
                    hsnHelperText.textContent = 'Please enter 8-digit tariff item HSN code';
                    hsnHelperText.className = 'mt-2 text-xs font-medium text-left text-red-500';
                    hsnSearchBtn.disabled = true;
                }
            }
        });

        // Handle Enter Key
        hsnInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !hsnSearchBtn.disabled) {
                triggerHSNSearch();
            }
        });

        // Search Button Click
        hsnSearchBtn.addEventListener('click', triggerHSNSearch);
    }

    // SAC Code Input Logic
    const sacInput = document.getElementById('sac-input-field');
    const sacSearchBtn = document.getElementById('sac-search-btn');

    if (sacInput && sacSearchBtn) {
        // Initialize helper text
        const sacHelperText = document.getElementById('sac-helper-text');
        if (sacHelperText) {
            sacHelperText.textContent = 'Please enter 6-digit service SAC code';
            sacHelperText.className = 'mt-2 text-xs font-medium text-left text-red-500';
        }

        // Handle Input
        sacInput.addEventListener('input', (e) => {
            let val = e.target.value;

            // Remove any existing hyphens and non-digits
            val = val.replace(/[^\d]/g, '');

            // Limit to 6 digits only
            val = val.slice(0, 6);

            // Apply SAC format: XXX-X-X-X (6 digits: 3-1-1-1)
            if (val.length > 5) {
                val = val.slice(0, 3) + '-' + val.slice(3, 4) + '-' + val.slice(4, 5) + '-' + val.slice(5, 6);
            } else if (val.length > 4) {
                val = val.slice(0, 3) + '-' + val.slice(3, 4) + '-' + val.slice(4, 5);
            } else if (val.length > 3) {
                val = val.slice(0, 3) + '-' + val.slice(3, 4);
            }

            e.target.value = val;

            // Update Search Button State and Helper Text
            const digitCount = val.replace(/-/g, '').length;
            const sacHelper = document.getElementById('sac-helper-text');

            if (sacHelper) {
                if (digitCount === 6) {
                    sacHelper.textContent = 'Valid SAC Service Code';
                    sacHelper.className = 'mt-2 text-xs font-medium text-left text-green-600';
                    sacSearchBtn.disabled = false;
                } else {
                    sacHelper.textContent = 'Please enter 6-digit service SAC code';
                    sacHelper.className = 'mt-2 text-xs font-medium text-left text-red-500';
                    sacSearchBtn.disabled = true;
                }
            }
        });

        // Handle Enter Key
        sacInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !sacSearchBtn.disabled) {
                triggerSACSearch();
            }
        });

        // Search Button Click
        sacSearchBtn.addEventListener('click', triggerSACSearch);
    }

    function triggerHSNSearch() {
        // Clear keyword input when doing code search
        const hsnKeywordInput = document.getElementById('hsn-keyword-input');
        if (hsnKeywordInput) hsnKeywordInput.value = '';
        
        // Hide keyword results
        const hsnKeywordResults = document.getElementById('hsn-keyword-results');
        if (hsnKeywordResults) hsnKeywordResults.classList.add('hidden');
        
        const hsnCodeInput = document.getElementById('hsn-input-field');
        const fullCode = hsnCodeInput ? hsnCodeInput.value.replace(/-/g, '') : '';

        if (!fullCode || fullCode.length !== 8) return;

        // Full HSN lookup (8 digits required)
        selectHSNCode(fullCode);
    }

    function triggerSACSearch() {
        // Clear keyword input when doing code search
        const sacKeywordInput = document.getElementById('sac-keyword-input');
        if (sacKeywordInput) sacKeywordInput.value = '';
        
        // Hide keyword results
        const sacKeywordResults = document.getElementById('sac-keyword-results');
        if (sacKeywordResults) sacKeywordResults.classList.add('hidden');
        
        const sacCodeInput = document.getElementById('sac-input-field');
        const fullCode = sacCodeInput ? sacCodeInput.value.replace(/-/g, '') : '';

        if (!fullCode || fullCode.length !== 6) return;

        // Full SAC lookup (6 digits required)
        selectSACCode(fullCode);
    }

});
</script>